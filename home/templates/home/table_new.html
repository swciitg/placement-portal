{% extends "home/base.html" %}

{% load static %}


{% block title %}
Table
{% endblock %}


{% block head %}
<head>
  <meta charset="UTF-8">
  <title>Bootstrap 4 Table</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>

{% endblock %}


{% block content %}

<style>
	.bg-custom {
		background-color: #023e8a;
	}

	.bg-custom-2 {
		background-color: #0077b6;
	}
</style>

<nav class="navbar navbar-expand-lg navbar-dark bg-custom">


	<div class="container-fluid">

		<a class="navbar-brand order-0 hov_class" href="{% url 'home:home' %}" style="cursor: pointer;"> <img style="max-width: 35px;max-height: 35px;" src="{% static 'images/logo.png' %}">Placement Statistics</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>

		<div class="collapse navbar-collapse" id="navbarColor01">
			<ul class="navbar-nav ml-auto">

				{% if request.user.is_authenticated %}

				<li class="nav-item active">
					<a class="nav-link" href="{% url 'home:charts' %}">Charts
					</a>
				</li>

				<li class="nav-item active">
					<a class="nav-link" href="{% url 'signout' %}">Logout
					</a>
				</li>
				{% else %}
				<li class="nav-item active">
					<a class="nav-link" href="{% url 'signin' %}">Click here to Login
					</a>
				</li>

				<a class="nav-item nav-link text-white hov_class" href="{% url 'signin' %}" style="cursor: pointer;"></a>
				{% endif %}

			</ul>

		</div>
	</div>

</nav>


<style>
	.navbar-dark .navbar-nav .active>.nav-link:hover {
		text-decoration:underline;
	}

	.navbar-dark .navbar-brand:hover {
		text-decoration:underline;

	}
</style>

<div class="container-fluid" style="padding: 2%">
  <div class="form-row mb-3" style="padding-bottom: 1%">
    <div class="col">
      <input type="text" class="form-control" id="search" placeholder="Search...">
    </div>
    <div class="col">
      <select id="filterBranch" class="form-control">
        <option value="all" selected>Branch</option>
        <option value="ME">ME</option>
        <option value="CST">CST</option>
        <option value="School of Agro and Rural Technology">School of Agro and Rural Technology</option>
        <option value="BT">BT</option>
        <option value="CL">CL</option>
        <option value="Chemistry">Chemistry</option>
        <option value="Physics">Physics</option>
        <option value="ECE">ECE</option>
        <option value="CE">CE</option>
        <option value="CSE">CSE</option>
        <option value="Design">Design</option>
        <option value="EP">EP</option>
        <option value="Energy">Energy</option>
        <option value="EEE">EEE</option>
        <option value="MNC">MNC</option>
        <option value="E-Mobility">E-Mobility</option>
        <option value="Rural Technology">Rural Technology</option>
        <option value="DS">DS</option>
        <option value="HSS">HSS</option>
        <option value="Centre for Intelligent Cyber Physical Systems">Centre for Intelligent Cyber Physical Systems</option>
        <option value="Interdisciplinary">Interdisciplinary</option>
        <option value="Centre for Disaster Management and Research">Centre for Disaster Management and Research</option>
        <option value="School of Energy Science and Engineering">School of Energy Science and Engineering</option>
      </select>
    </div>
    <div class="col">
      <select id="filterProgram" class="form-control">
        <option value="all" selected>Program</option>
        <option value="B.Tech">B.Tech</option>
        <option value="B.Des">B.Des</option>
        <option value="M.Tech">M.Tech</option>
        <option value="M.Des">M.Des</option>
        <option value="M.Sc">M.Sc</option>
        <option value="Phd">Phd</option>
        <option value="Others">Others</option>
        <!-- Populate with program options -->
      </select>
    </div>
    <div class="col">
      <select id="filterYear" class="form-control">
        <option value="all" selected>Year</option>
        <option value="2023">2023</option>
        <option value="2022">2022</option>
        <!-- Populate with year options -->
      </select>
    </div>
  </div>

  <div class="table-responsive-lg" >
    <table id="dataTable" class="table table-bordered table-striped">
      {% comment %} <thead>
        <tr>
          <th>Name</th>
          <th>Program</th>
          <th>Branch</th>
          <th>Roll Number</th>
          <th>Company</th>
          <th>Profile</th>
        </tr>
      </thead> {% endcomment %}
      <thead class="bg-custom">
        <tr class="row100 head">
            <th style="color: white;border-top-left-radius: 16px;" class="column100 column1" data-column="column1">NAME</th>
            <th style="color: white;" class="column100 column2" data-column="column2">Program</th>
            <th style="color: white;" class="column100 column3" data-column="column3">Branch</th>
            <th style="color: white;" class="column100 column4" data-column="column4">Roll No.</th>
            <th style="color: white;" class="column100 column5 " data-column="column5">Company</th>
            {% comment %} <th style="color: white;" class="column100 column6 " data-column="column6">Profile</th> {% endcomment %}
            <th style="color: white;border-top-right-radius:  16px;" class="column100 column6" data-column="column6">Profile</th>
        </tr>
    </thead>
      <tbody>
        <!-- Table body content will be filled dynamically -->
      </tbody>
      <tfoot class="bg-custom">
        <tr class="row100 head">
            <th style="color: white;border-bottom-left-radius: 16px;" class="column100 column1" data-column="column1">NAME</th>
            <th style="color: white;" class="column100 column2" data-column="column2">Program</th>
            <th style="color: white;" class="column100 column3" data-column="column3">Branch</th>
            <th style="color: white;" class="column100 column4" data-column="column4">Roll No.</th>
            <th style="color: white;" class="column100 column5 " data-column="column5">Company</th>
            {% comment %} <th style="color: white;" class="column100 column6 " data-column="column6">Profile</th> {% endcomment %}
            <th style="color: white;border-bottom-right-radius:  16px;" class="column100 column6" data-column="column6">Profile</th>
        </tr>
    </tfoot>
    </table>
    <div class="d-flex justify-content-between">
    <div class="d-flex align-items-center">
        <h6> To see statistics table in previous format, click <a href="{% url 'home:table_old' %}">here</a></h6>
      </div>
    <div id="pagination" class="d-flex align-items-center"></div>
    </div>
  </div>

  
</div>

{% include "footer.html" %}

{% endblock %}


{% block scripts %}

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    // Perform AJAX call to fetch data based on filters, sorting, and pagination
function fetchData(page, pageSize, filters, sortColumn, sortOrder) {
    // Your AJAX request here
    // Example:
    $.ajax({
      url: '/placement-stats/fetch-data/',
      method: 'GET',
      data: {
        page: page,
        pageSize: pageSize,
        filters: filters,
        sortColumn: sortColumn,
        sortOrder: sortOrder
      },
      success: function(response) {
        // Handle the response and populate table
        populateTable(response.data);
        updatePaginationUI(page, response.totalPages);
      },
      error: function(error) {
        console.error('Error fetching data:', error);
      }
    });
  }
  
  // Populate table with data
  function populateTable(data) {
    // Clear previous table content
    $('#dataTable tbody').empty();
  
    // Loop through data and create table rows
    data.forEach(function(item) {
      $('#dataTable tbody').append(`
        <tr>
          <td>${item.name}</td>
          <td>${item.program}</td>
          <td>${item.branch}</td>
          <td>${item.rollNumber}</td>
          <td>${item.company}</td>
          <td>${item.profile}</td>
        </tr>
      `);
    });
  }
  
  // Function to handle pagination, filtering, and sorting changes
  function handleTableInteractions() {
    let currentPage = 1;
    const pageSize = 15;
    let filters = {};
    let sortColumn = '';
    let sortOrder = '';
  
    // Fetch initial data
    fetchData(currentPage, pageSize, filters, sortColumn, sortOrder);
  
    // Pagination click event
    $('#pagination').on('click', 'a.page-link', function(e) {
      e.preventDefault();
      currentPage = parseInt($(this).attr('data-page'));
      fetchData(currentPage, pageSize, filters, sortColumn, sortOrder);
    });
  
    // Filtering and sorting change events
    $('#search, #filterBranch, #filterProgram, #filterYear').on('change keyup', function() {
      currentPage = 1;
      filters = {
        search: $('#search').val(),
        branch: $('#filterBranch').val(),
        program: $('#filterProgram').val(),
        year: $('#filterYear').val()
      };
      fetchData(currentPage, pageSize, filters, sortColumn, sortOrder);
    });
  
    // Sorting click event
    $('#dataTable th').on('click', function() {
      sortColumn = $(this).text().toLowerCase().replace(' ', '_');
      sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
      fetchData(currentPage, pageSize, filters, sortColumn, sortOrder);
    });
  }

  // Function to populate pagination links
// ... (previous JavaScript code remains the same) ...

// Function to handle sorting on the client-side
function handleSorting() {
    $('#dataTable th').on('click', function() {
      const column = $(this).text().toLowerCase().replace(' ', '_');
      let sortOrder = $(this).data('sort') || 'asc';
  
      sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
  
      // Reset data-sort attribute for other columns
      $('#dataTable th').removeAttr('data-sort');
      $(this).data('sort', sortOrder);
  
      const filters = {
        search: $('#search').val(),
        branch: $('#filterBranch').val(),
        program: $('#filterProgram').val(),
        year: $('#filterYear').val()
      };
  
      const currentPage = 1;
      const pageSize = 15;
  
      fetchData(currentPage, pageSize, filters, column, sortOrder);
    });
  }
  
  // Function to update pagination UI
// ... (previous code remains the same) ...

// Function to update pagination UI
    function updatePaginationUI(currentPage, totalPages) {
                let paginationHTML = `
            <nav aria-label="Page navigation example">
            <ul class="pagination">
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                <a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>
                </li>
        `;

        // Determine the range of visible page links
        let startPage = Math.max(1, currentPage - 2);
        let endPage = Math.min(totalPages, currentPage + 2);

        // Display 'First' page link if not on the first page
        if (startPage > 1) {
            paginationHTML += `
            <li class="page-item">
                <a class="page-link" href="#" data-page="1">1</a>
            </li>
            ${startPage > 2 ? '<li class="page-item disabled"><span class="page-link">...</span></li>' : ''}
            `;
        }

        // Display page links within the range
        for (let i = startPage; i <= endPage; i++) {
            paginationHTML += `
            <li class="page-item ${currentPage === i ? 'active' : ''}">
                <a class="page-link" href="#" data-page="${i}">${i}</a>
            </li>
            `;
        }

        // Display 'Last' page link if not on the last page
        if (endPage < totalPages) {
            paginationHTML += `
            ${endPage < totalPages - 1 ? '<li class="page-item disabled"><span class="page-link">...</span></li>' : ''}
            <li class="page-item">
                <a class="page-link" href="#" data-page="${totalPages}">${totalPages}</a>
            </li>
            `;
        }

        paginationHTML += `
            <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                <a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>
            </li>
            </ul>
        </nav>
        `;
        $('#pagination').html(paginationHTML);
    }
        
  
  // Function to handle pagination UI click events
  function handlePagination() {
    $('#pagination').on('click', 'a.page-link', function(e) {
      e.preventDefault();
      const nextPage = parseInt($(this).data('page'));
      const pageSize = 15;
      const filters = {
        search: $('#search').val(),
        branch: $('#filterBranch').val(),
        program: $('#filterProgram').val(),
        year: $('#filterYear').val()
      };
      const sortColumn = $('#dataTable th[data-sort]').text().toLowerCase().replace(' ', '_');
      const sortOrder = $('#dataTable th[data-sort]').data('sort');
  
      fetchData(nextPage, pageSize, filters, sortColumn, sortOrder);
    });
  }
  
  // Call the function to handle interactions when the document is ready
  $(document).ready(function() {
    handleTableInteractions();
    handleSorting();
    handlePagination();
  });
  
</script>  

{% endblock %}

